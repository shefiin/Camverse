<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Michroma&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body style="font-family:'Open Sans', sans-serif";>

    <%- include('../partials/userNavbar') %>

    <section class="px-6 py-20 lg:px-12 lg:py-20 md-px-10 mt-8">

        <div class="px-6 py-20 lg:px-12 lg:py-20">
            <h1 class="text-2xl md:text-3xl text-gray-800 text-center mb-16">My Wallet</h1>

            <div class="p-6 bg-gray-50">
                <div class="p-20 max-w-4xl bg-white mx-auto shadow-2xl">
                
                    <!-- Balance Card -->
                    <div class="bg-white rounded-lg shadow p-5 flex items-center justify-between mb-10">
                      <div class="flex items-center gap-3">
                        <div class="bg-white shadow p-3 rounded-full">
                          <i class="fa-solid fa-wallet text-green-800 text-xl"></i>
                        </div>
                        <div>
                          <p class="text-gray-700 text-lg font-semibold">Current Balance</p>
                          <p class="text-sm text-gray-500">Available for purchases and refunds</p>
                        </div>
                      </div>
                      <p class="text-2xl font-semibold text-gray-900">₹<%= (wallet && wallet.transactions.length > 0 ? wallet.balance.toLocaleString() : 0) %>.00</p>
                    </div>
                    <h1 class="text-xl font-semibold text-gray-900 mb-6">Wallet Transaction History</h1>

                
                    <!-- Filters + Search + Sort -->
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-6">
                        <!-- Filters -->
                        <div class="flex items-center gap-2">
                        <span class="text-gray-600">Filter: 
                            <i class="fa-solid fa-filter text-gray-400"></i>
                        </span>
                        <button onclick="filterTx('all')" class="filter-btn px-3 py-1 rounded-full bg-black text-white text-sm">All</button>
                        <button onclick="filterTx('CREDIT')" class="filter-btn px-3 py-1 rounded-full bg-black text-gray-600 text-sm">Credits</button>
                        <button onclick="filterTx('DEBIT')" class="filter-btn px-3 py-1 rounded-full bg-bla text-gray-600 text-sm">Debits</button>
                        </div>
                    
                        <!-- Search + Sort -->
                        <div class="flex items-center gap-3 w-full md:w-auto">
                        <input id="searchBox" type="text" placeholder="Search transactions..."
                                onkeyup="searchTx()"
                                class="border rounded-md px-3 py-2 text-sm w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    
                        <select id="sortSelect" onchange="sortTx()" 
                                class="border rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="high">High → Low</option>
                            <option value="low">Low → High</option>
                        </select>
                        </div>
                    </div>
                  
                    <div id="transactions" class="space-y-4">
                        <% if (wallet && wallet.transactions.length > 0) { %>
                        <% wallet.transactions.forEach(tx => { %>
                            <div class="tx-item bg-white p-4 rounded hover:shadow-lg shadow flex items-start justify-between"
                            data-type="<%= tx.type %>"
                            data-desc="<%= (tx.description || '').toLowerCase() %>"
                            data-amount="<%= tx.amount %>"
                            data-date="<%= tx.createdAt %>">
                       
                         <div>
                           <p class="text-gray-800 font-medium">
                             <%= tx.description || (tx.type === "CREDIT" ? "Amount Credited" : "Amount Debited") %>
                           </p>
                       
                           <!-- Format date -->
                           <p class="text-sm font-extralight text-gray-500">
                             <%= new Date(tx.createdAt).toLocaleDateString("en-IN", {
                                     year: "numeric",
                                     month: "short",
                                     day: "numeric"
                                 }) %> • 
                             <%= new Date(tx.createdAt).toLocaleTimeString("en-IN", {
                                     hour: "2-digit",
                                     minute: "2-digit"
                                 }) %>
                           </p>
                       
                           <!-- Link to order -->
                           <% if (tx.orderId) { %>
                             <a href="/order/details/<%= tx.orderId %>" class="text-blue-600 text-sm font-medium">
                               View Order
                             </a>
                           <% } %>
                         </div>
                       
                         <!-- Amount -->
                         <p class="<%= tx.type === 'CREDIT' ? 'text-green-600' : 'text-red-600' %> font-normal my-auto">
                           <%= tx.type === 'CREDIT' ? '+ ' : '- ' %>₹<%= tx.amount.toLocaleString() %>
                         </p>
                       </div>
                       
                        <% }) %>
                        <% } else { %>
                        <p class="text-gray-500 text-center">No transactions yet.</p>
                        <% } %>
                    </div>
  
                </div>
            </div>
              
        </div>
          
    </section>    

    <%- include('../partials/mobileFilter') %>

    <%- include('../partials/userFooter') %>

    <script src="/js/user/homePage.js"></script>

    <script>
        function filterTx(type) {
          document.querySelectorAll('.tx-item').forEach(item => {
            if (type === 'all' || item.dataset.type === type) {
              item.style.display = 'flex';
            } else {
              item.style.display = 'none';
            }
          });
        
          // highlight active filter
          document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('bg-black','text-white'));
          event.target.classList.add('bg-black','text-white');
        }
        
        function searchTx() {
          const query = document.getElementById("searchBox").value.toLowerCase();
          document.querySelectorAll('.tx-item').forEach(item => {
            item.style.display = item.dataset.desc.includes(query) ? 'flex' : 'none';
          });
        }
        
        function sortTx() {
          const sortBy = document.getElementById("sortSelect").value;
          let items = Array.from(document.querySelectorAll('.tx-item'));
          const container = document.getElementById("transactions");
        
          items.sort((a, b) => {
            let amountA = parseFloat(a.dataset.amount);
            let amountB = parseFloat(b.dataset.amount);
            let dateA = new Date(a.dataset.date);
            let dateB = new Date(b.dataset.date);
        
            switch (sortBy) {
              case "newest": return dateB - dateA;
              case "oldest": return dateA - dateB;
              case "high": return amountB - amountA;
              case "low": return amountA - amountB;
            }
          });
        
          container.innerHTML = "";
          items.forEach(i => container.appendChild(i));
        }
        </script>
        

</body>
</html>        